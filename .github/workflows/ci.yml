name: ci

on:
  pull_request:
  push:
    branches: [master]

env:
  CARGO_TERM_COLOR: always
  SCCACHE_GHA_ENABLED: true
  RUSTC_WRAPPER: sccache

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: dtolnay/rust-toolchain@stable
      - name: Setup sccache
        uses: mozilla-actions/sccache-action@v0.0.9
      - name: Setup mold
        uses: rui314/setup-mold@v1
      - name: Run tests
        run: cargo test --workspace --all-features

  fmt:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: dtolnay/rust-toolchain@stable
        with:
          components: rustfmt
      - name: Check formatting
        run: cargo fmt --check

  clippy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy
      - name: Setup sccache
        uses: mozilla-actions/sccache-action@v0.0.9
      - name: Setup mold
        uses: rui314/setup-mold@v1
      - name: Lint code
        run: cargo clippy --workspace --all-features

  i18n:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: dtolnay/rust-toolchain@stable

      - name: Cache es-fluent-cli
        uses: actions/cache@v4
        with:
          path: ~/.cargo/bin/cargo-es-fluent
          key: ${{ runner.os }}-es-fluent-cli

      - name: Install es-fluent-cli
        run: cargo install es-fluent-cli --locked

      - name: Run es-fluent check
        run: cargo es-fluent check
