# koruma-core Architecture

## Overview

The `koruma-core` crate provides the foundational traits and types for the Koruma validation framework. It defines the contracts that validators, validated structs, and error types must fulfill.

## Role in the Workspace

```
koruma-core (this crate - foundation)
    ↑
    └── Used by: koruma, koruma-derive, koruma-collection
```

This crate has no dependencies on other workspace crates, making it the foundation layer.

## Module Structure

```
src/
└── lib.rs    # All trait definitions
```

## Core Traits

### `Validate<T>`

The primary trait that all validators must implement:

```rust
pub trait Validate<T> {
    fn validate(&self, value: &T) -> bool;
}
```

Validators return `true` if validation passes, `false` otherwise. The trait is generic over `T`, allowing validators to work with any type.

### `ValidationError`

Trait for generated error structs:

```rust
pub trait ValidationError {
    fn is_empty(&self) -> bool;
    fn has_errors(&self) -> bool;
}
```

Generated error structs implement this to indicate whether any validation failures occurred.

### `BuilderWithValue<T>`

Support for builder patterns that receive validated values:

```rust
pub trait BuilderWithValue<T> {
    fn value(self, value: T) -> Self;
}
```

Used in conjunction with `bon` builders for validated construction.

### `ValidateExt`

Extension trait for structs that have validation:

```rust
pub trait ValidateExt {
    type Error: ValidationError;
    fn validate(&self) -> Result<(), Self::Error>;
}
```

Generated by `#[derive(Koruma)]` on user structs.

### `NewtypeValidation`

Marker trait for newtype wrapper validation:

```rust
pub trait NewtypeValidation {
    type Inner;
    type Error: ValidationError;
    fn validate(value: &Self::Inner) -> Result<(), Self::Error>;
}
```

Used for single-field structs with the `#[koruma(newtype)]` attribute.

## Showcase Module

When the `showcase` feature is enabled, provides types for validator discovery:

```rust
pub struct ValidatorShowcase { ... }
pub static INVENTORY: ... // Global validator registry
```

Uses the `inventory` crate for compile-time validator registration.

## Design Decisions

### Minimal Dependencies

The core crate has minimal dependencies (only optional `inventory`) to:

- Reduce compile times
- Minimize dependency conflicts
- Provide stable foundation

### Trait-Based Design

Using traits allows:

- Generic validation over any type
- Composition of validators
- Type-safe error handling

### Separation from Macros

Keeping traits separate from macro implementation allows:

- Core traits to remain stable
- Macro implementation to evolve independently
- External tools to depend on stable types

## Features

| Feature | Default | Description |
|---------|---------|-------------|
| `showcase` | No | Enables validator discovery via `inventory` |
